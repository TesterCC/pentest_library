#!/usr/bin/env python
# -*- coding:utf-8 -*-
# @Time : 2021/3/13 00:45
# @Author : SecCodeCat

from scapy.all import *

# from scapy.config import conf

# ref: https://scapy.readthedocs.io/en/latest/


# super sockets config, ref: https://blog.csdn.net/wang_walfred/article/details/40072751
conf.use_pcap = True


# print(conf)   # conf 变量保存了配置信息

def GetInterface():
    # get windows default network Ethernet card name
    conf.route.resync()
    return conf.route.route('0.0.0.0')[0]


def pack_callback(packet):
    # print(packet.show())

    # print payload
    # print(packet.payload.original)
    # print(packet.payload.original.hex())

    # import pdb;pdb.set_trace()
    # print(packet.show2())
    # print(dir(packet))

    # packet.haslayer('Ethernet')
    # packet.haslayer('ARP')
    # packet.haslayer('UDP')

    print(len(packet['Ethernet']))
    print(len(packet))  # 和以太层Ethernet打印一致，应该是是从以太层开始计算。 ref: https://stackoverflow.com/questions/10552067/get-packet-size-in-scapy-python
    print("-")
    print(packet.sprintf("%IP.len%"))
    if packet.haslayer('IP'):
        print(packet['IP'])
    print("=====")

    if packet.haslayer('Ethernet'):
        print("[+] Get {} Info:".format("Ethernet"))
        print(packet['Ethernet'].src)
        print(packet['Ethernet'].dst)
        print(packet['Ethernet'].type)
        print("\n")

    if packet.haslayer('UDP'):
        print("[+] Get {} Info:".format("UDP"))
        print(packet['UDP'].sport)
        print(packet['UDP'].dport)
        print(packet['UDP'].len)
        print("\n")

    if packet.haslayer('ARP'):
        print("[+] Get {} Info:".format("ARP"))
        print(packet['ARP'].psrc)
        print(packet['ARP'].pdst)
        print(packet['ARP'].hwsrc)
        print(packet['ARP'].hwdst)
        print("\n")


if __name__ == '__main__':
    # print(GetInterface())  # get windows default Ethernet card name
    # show_interfaces() 获取网卡列表
    p = sniff(iface='Realtek PCIe GBE Family Controller', prn=pack_callback, count=0)
